{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de usuario</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'users/css/register_users.css' %}" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkOE6tdxKR6yicdhzVF7109pAF_zMYzv4&libraries=places&callback=initMap"></script>
  <style>
    #map {
      height: 300px;
      width: 100%;
    }

    /* cuadro de búsqueda */
    .pac-container {
      position: absolute;
      z-index: 10000;
      width: 100%;
    }
  </style>
</head>

<body>
  <main>
    <div class="custom-box">
      <div class="custom-inner-box">
        <div class="custom-forms-wrap">
          <form action="index.html" autocomplete="off" class="sign-in-form" id="sign-in-form">
            {% csrf_token %}
            <div class="logo">
              <a href=""><img src="{% static 'users/images/Logo-Velaroma-Sin-FondoPEQUE.png' %}" alt="easyclass" /></a>
              <h4><a href="{% url 'home' %}">Vela<span>roma</span></a></h4>
            </div>

            <div class="heading">
              <h2>Iniciemos</h2>
              <h6>¿Ya tienes una cuenta?</h6>
              <a href="{% url 'home' %}?openModal=true" class="toggle">Inicia Sesión</a>
            </div>


            <div class="actual-form registrarse-actual-form">
              <div class="input-wrap">
                <input type="text" class="input-field" autocomplete="off" name="name" id="name" required />
                <label>Nombre(s)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" autocomplete="off" name="lastname" id="lastname" required />
                <label>Apellidos(s)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" autocomplete="nope" name="email" id="email" required />
                <label>Correo electrónico</label>
                <div class="custom-tooltip" id="error-email-tooltip"></div>
              </div>


              <div class="input-wrap">
                <input type="password" class="input-field" autocomplete="off" id="password" name="password" required />
                <label>Contraseña</label>
                <div class="custom-tooltip" id="password-error"></div>
              </div>


              <div class="input-wrap">
                <input type="password" class="input-field" autocomplete="off" id="confirm-password" disabled required />
                <label>Repetir contraseña</label>
                <div class="custom-tooltip" id="confirm-password-error"></div>
              </div>

              <!-- Agrega este botón en el lugar adecuado de tu HTML -->
              <button class="skip-validation-btn">Saltar Validaciones</button>

              <button type="button" class="sign-btn toggle" disabled>Continuar</button>

              <div class="input-wrap input-wrap-google">
                <button class="button">
                  <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" viewBox="0 0 256 262">
                    <path fill="#4285F4"
                      d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027">
                    </path>
                    <path fill="#34A853"
                      d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1">
                    </path>
                    <path fill="#FBBC05"
                      d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782">
                    </path>
                    <path fill="#EB4335"
                      d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251">
                    </path>
                  </svg>
                  Registrarme con Google
                </button>
              </div>


              <script>

              </script>


              <p class="text">
                Al registrarme, estoy de acuerdo a los
                <a href="#">Terminos y condiciones</a> y
                <a href="#">Politicas de privacidad</a>
              </p>
            </div>

          </form>

          <form action="index.html" autocomplete="off" class="sign-up-form">
            <div class="logo">
              <a href=""><img src="{% static 'users/images/Logo-Velaroma-Sin-FondoPEQUE.png' %}" alt="easyclass" /></a>
              <h4><a href="{% url 'home' %}">Vela<span>roma</span></a></h4>
            </div>

            <div class="heading registrarse-heading">
              <h2>Ubicación</h2>
            </div>

            <div class="actual-form ubicacion-actual-form">
              <div class="input-wrap">
                <input type="text" class="form-control input-field" id="addressInput" required onclick="openModal()">
                <label>Ubicar en el mapa</label>

              </div>


              <input type="hidden" id="latitude" name="latitude">
              <input type="hidden" id="longitude" name="longitude">

              <div class="input-wrap">
                <input type="text" class="input-field" autocomplete="off" name="houseNumber" id="houseNumber"
                  required />
                <label>Número de casa (Opcional)</label>
              </div>

              <div class="textarea-wrap">
                <textarea name="text" id="text" rows="1" oninput="autoGrowTextArea(this)" maxlength="100"
                  required></textarea>
                <label for="text">Indicaciones para la entrega</label>
              </div>
              <div class="label-area">
                <label class="custom-label" id="char-count-indicaciones">0/100</label>
              </div>

              <!-- Si necesitas un tooltip para el textarea, agrega este elemento -->
              <div class="textarea-tooltip" id="indicaciones-tooltip"></div>

              <div class="input-wrap">
                <input type="tel" class="input-field" maxlength="8" oninput="limitInputToEightDigits(event)"
                  name="telephoneNumber" id="telephoneNumber" autocomplete="off" required />
                <label>Número de teléfono</label>
              </div>

              <div class="input-wrap">
                <label>Nombre de esa dirección</label>
              </div>

              <div class="radio-buttons-container">
                <div class="radio-button">
                  <input name="radio-group" id="radio2" class="radio-button__input" type="radio">
                  <label for="radio2" class="radio-button__label">
                    <span class="radio-button__custom"></span>
                    Casa
                  </label>
                </div>
                <div class="radio-button">
                  <input name="radio-group" id="radio1" class="radio-button__input" type="radio">
                  <label for="radio1" class="radio-button__label">
                    <span class="radio-button__custom"></span>
                    Trabajo
                  </label>
                </div>
                <div class="radio-button">
                  <input name="radio-group" id="radio3" name="radio3" class="radio-button__input" type="radio">
                  <label for="radio3" class="radio-button__label">
                    <span class="radio-button__custom"></span>
                    Otros
                  </label>
                </div>
              </div>

              <input type="submit" value="Guardar ahora" class="sign-btn" id="saveButton" />

              <p class="text">
                Forgotten your password or you login datails?
                <a href="#">Get help</a> signing in
              </p>
            </div>
          </form>
        </div>

        <div class="custom-carousel">
          <div class="images-wrapper">
            <img src="{% static 'users/images/Velaroma login+.png' %} " class="image img-1 show" alt="" />
            <img src="{% static 'users/images/ubication4.png' %}" class="image img-2" alt="" />
          </div>

          <div class="text-slider">
            <div class="text-wrap">
              <div class="text-group">
                <h2>Paso No. 1</h2>
                <h2>Paso No. 2</h2>
                <h2></h2>
              </div>
            </div>

            <div class="bullets">
              <span class="active" data-value="1"></span>
              <span data-value="2"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="myModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <div class="modal-header">
            <h4 class="modal-title">Escoge tú <span>ubicación</span></h4>
          </div>

          <div class="modal-body">
            <div class="input-wrap mt-1">
              <input type="text" class="input-field" id="searchInput" placeholder="" autocomplete="off" required />
              <label for="otros-input">Busca un lugar</label>
            </div>
            <div class="mt-3" id="map"></div>
            <p class="mt-3"><strong>Ubicación seleccionada:</strong> <span id="selectedLocationLabel"></span></p>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn sign-btn" id="getLocationButton">Obtener dirección actual</button>
            <button type="button" class="btn sign-btn" id="saveLocation">Guardar</button>
          </div>



        </div>
      </div>
    </div>

    <!-- Modal alerts -->
    <div class="modal" id="modalAlerts">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Error</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalAlertsBody">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Entendido</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal HTML -->
    <div class="modal" id="otrosModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="otrosModalLabel">Introduzca el nombre de la dirección</h5>
          </div>
          <div class="modal-body">

            <div class="textarea-wrap mt-3">
              <textarea name="text" id="otros-input" rows="1" oninput="autoGrowTextArea(this)" maxlength="5"
                required></textarea>
              <label for="text">Nombre</label>
            </div>
            <div class="label-area">
              <label class="custom-label" id="char-count">0/5</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="sign-btn" data-dismiss="modal" id="guardarBtn">Guardar</button>
          </div>
        </div>
      </div>
    </div>
    </div>

  </main>


  <!-- Javascript file -->
  <script src="{% static 'users/js/register_user.js' %}"></script>
  <script>
    var map;
    var marker;
    var searchBox;

    function initMap() {
      var location = new google.maps.LatLng(12.11501075424433, -86.2360456940407);
      var mapOptions = {
        center: location,
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        disableDefaultUI: true, // Desactiva la interfaz predeterminada del mapa
        mapTypeControl: false, // Desactiva el control de tipos de mapa (Satélite, Mapa)
      };
      map = new google.maps.Map(document.getElementById("map"), mapOptions);
      marker = new google.maps.Marker({
        position: location,
        map: map,
        draggable: true
      });

      google.maps.event.addListener(marker, "dragend", function () {
        updateAddressFromMarker();
      });

      searchBox = new google.maps.places.SearchBox(document.getElementById("searchInput"));

      searchBox.addListener("places_changed", function () {
        var places = searchBox.getPlaces();
        if (places.length === 0) return;

        var bounds = new google.maps.LatLngBounds();
        places.forEach(function (place) {
          if (!place.geometry) return;

          if (place.geometry.viewport) {
            bounds.union(place.geometry.viewport);
          } else {
            bounds.extend(place.geometry.location);
          }

          // Establecer la ubicación del marcador en la ubicación seleccionada del cuadro de búsqueda
          marker.setPosition(place.geometry.location);
          map.fitBounds(bounds);
          updateAddressFromMarker();
        });
      });

      $("#getLocationButton").click(function () {
        getCurrentLocation();
      });

      $("#saveLocation").click(function () {
        var address = $("#addressInput").val();
        var latitude = marker.getPosition().lat();
        var longitude = marker.getPosition().lng();

        // Set the values of hidden inputs
        $("#latitude").val(latitude);
        $("#longitude").val(longitude);

        alert("Address saved: " + address);
        $("#myModal").modal("hide");
      });
    }

    function updateAddressFromMarker() {
      var latLng = marker.getPosition();
      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({ location: latLng }, function (results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
          if (results[0]) {
            $("#addressInput").val(results[0].formatted_address);
            $("#selectedLocationLabel").text(results[0].formatted_address);
          }
        }
      });
    }

    function openModal() {
      $("#myModal").modal("show");
    }

    function getCurrentLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            var latLng = new google.maps.LatLng(
              position.coords.latitude,
              position.coords.longitude
            );
            map.setCenter(latLng);
            map.setZoom(15);
            marker.setPosition(latLng);
            updateAddressFromMarker();
          },
          function (error) {
            alert("Error obteniendo la dirección: " + error.message);
          }
        );
      } else {
        alert("La geolocalización no es soportada en este navegador.");
      }
    }
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const radio3 = document.getElementById("radio3");
      const otrosModal = new bootstrap.Modal(document.getElementById("otrosModal"));
      const guardarBtn = document.getElementById("guardarBtn");
      const otrosInputLabel = document.querySelector(".radio-button__label[for='radio3']");

      radio3.addEventListener("click", function () {
        $("#otrosModal").modal("show");
      });


      guardarBtn.addEventListener("click", function () {
        const otrosInput = document.getElementById("otros-input").value;
        otrosInputLabel.textContent = otrosInput;
        otrosModal.hide();
      });
    });
  </script>

  <script>
    document.getElementById('saveButton').addEventListener("click", function (e) {

      // document.getElementById('saveButton').classList.add('disabled-button');
      e.preventDefault();

      // Obtén el token CSRF del formulario
      let csrfToken = document.getElementById('sign-in-form').querySelector('[name=csrfmiddlewaretoken]').value;
      console.log(csrfToken);

      let data = {
        csrfmiddlewaretoken: csrfToken,
        name: document.getElementById('name').value,
        lastname: document.getElementById('lastname').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        addressInput: document.getElementById('addressInput').value,
        latitude: document.getElementById('latitude').value,
        longitude: document.getElementById('longitude').value,
        houseNumber: document.getElementById('houseNumber').value,
        text: document.getElementById('text').value,
        telephoneNumber: document.getElementById('telephoneNumber').value,
        radio2: document.getElementById('radio2').value
      };

      fetch('/register_user_API/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(data)
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data as needed
          console.log(data);

          if (data.status === 'success') {

            window.location.href = "/";



          } else {
            document.getElementById("modalAlertsBody").innerText = data.message;
            $("#modalAlerts").modal("show");

          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    });
  </script>
</body>

</html>